{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Django Template Injection",
  "scopeName": "source.django.injection",
  "injectionSelector": "L:text.html, L:text.html.basic, L:text.html.derivative, L:source.js, L:source.js.jsx, L:source.ts, L:source.tsx, L:text.xml, L:text.xml.xsl, L:comment.block.js, L:comment.block.ts, L:comment.block",
  "patterns": [
    { "include": "#wrapped-django-tags" },
    { "include": "#django-template-tags" },
    { "include": "#django-template-variables" },
    { "include": "#django-comments" }
  ],
  "repository": {
    "wrapped-django-tags": {
      "patterns": [
        {
          "comment": "Django tags wrapped in /* */ for TS/JS compatibility",
          "name": "meta.embedded.django.wrapped",
          "match": "(/\\*)\\s*(\\{%[\\s\\S]*?%\\}|\\{\\{[\\s\\S]*?\\}\\}|\\{#[\\s\\S]*?#\\})\\s*(\\*/)",
          "captures": {
            "1": {
              "name": "punctuation.definition.comment.begin.django-wrapper"
            },
            "2": {
              "patterns": [
                { "include": "#django-template-tags" },
                { "include": "#django-template-variables" },
                { "include": "#django-comments" }
              ]
            },
            "3": { "name": "punctuation.definition.comment.end.django-wrapper" }
          }
        }
      ]
    },
    "django-template-tags": {
      "patterns": [
        {
          "name": "meta.tag.template.block.django",
          "begin": "(\\{%)(-)?\\s*",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.django" },
            "2": { "name": "keyword.operator.whitespace.django" }
          },
          "end": "\\s*(-)?(%\\})",
          "endCaptures": {
            "1": { "name": "keyword.operator.whitespace.django" },
            "2": { "name": "punctuation.definition.tag.end.django" }
          },
          "patterns": [
            { "include": "#django-tag-keywords" },
            { "include": "#django-filters" },
            { "include": "#django-strings" },
            { "include": "#django-numbers" },
            { "include": "#django-operators" },
            { "include": "#django-variables-inner" }
          ]
        }
      ]
    },
    "django-template-variables": {
      "patterns": [
        {
          "name": "meta.tag.template.variable.django",
          "begin": "(\\{\\{)(-)?\\s*",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.variable.begin.django" },
            "2": { "name": "keyword.operator.whitespace.django" }
          },
          "end": "\\s*(-)?(\\.\\}\\}|\\}\\})",
          "endCaptures": {
            "1": { "name": "keyword.operator.whitespace.django" },
            "2": { "name": "punctuation.definition.variable.end.django" }
          },
          "patterns": [
            { "include": "#django-filters" },
            { "include": "#django-strings" },
            { "include": "#django-numbers" },
            { "include": "#django-operators" },
            { "include": "#django-variables-inner" }
          ]
        }
      ]
    },
    "django-comments": {
      "patterns": [
        {
          "name": "comment.block.django",
          "begin": "\\{#",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.comment.begin.django" }
          },
          "end": "#\\}",
          "endCaptures": {
            "0": { "name": "punctuation.definition.comment.end.django" }
          }
        },
        {
          "name": "comment.block.django.multiline",
          "begin": "(\\{%)\\s*(comment)\\s*(%\\})",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.django" },
            "2": { "name": "keyword.control.comment.django" },
            "3": { "name": "punctuation.definition.tag.end.django" }
          },
          "end": "(\\{%)\\s*(endcomment)\\s*(%\\})",
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.django" },
            "2": { "name": "keyword.control.comment.django" },
            "3": { "name": "punctuation.definition.tag.end.django" }
          }
        }
      ]
    },
    "django-tag-keywords": {
      "patterns": [
        {
          "name": "keyword.control.flow.django",
          "match": "\\b(if|elif|else|endif|for|empty|endfor|while|endwhile)\\b"
        },
        {
          "name": "keyword.control.block.django",
          "match": "\\b(block|endblock|extends|include|load|macro|endmacro|call|endcall|set|endset)\\b"
        },
        {
          "name": "keyword.control.import.django",
          "match": "\\b(import|from|as)\\b"
        },
        {
          "name": "keyword.control.filter.django",
          "match": "\\b(filter|endfilter)\\b"
        },
        {
          "name": "keyword.control.with.django",
          "match": "\\b(with|endwith)\\b"
        },
        {
          "name": "keyword.control.autoescape.django",
          "match": "\\b(autoescape|endautoescape)\\b"
        },
        {
          "name": "keyword.control.spaceless.django",
          "match": "\\b(spaceless|endspaceless)\\b"
        },
        {
          "name": "keyword.control.verbatim.django",
          "match": "\\b(verbatim|endverbatim)\\b"
        },
        {
          "name": "keyword.control.url.django",
          "match": "\\b(url|static|csrf_token|trans|blocktrans|endblocktrans|plural)\\b"
        },
        {
          "name": "keyword.control.cache.django",
          "match": "\\b(cache|endcache)\\b"
        },
        {
          "name": "keyword.control.cycle.django",
          "match": "\\b(cycle|firstof|ifchanged|endifchanged|ifequal|endifequal|ifnotequal|endifnotequal)\\b"
        },
        {
          "name": "keyword.control.debug.django",
          "match": "\\b(debug|now|regroup|resetcycle|templatetag|widthratio)\\b"
        },
        {
          "name": "keyword.operator.logical.django",
          "match": "\\b(and|or|not|in|is)\\b"
        },
        {
          "name": "constant.language.django",
          "match": "\\b(True|False|None)\\b"
        }
      ]
    },
    "django-filters": {
      "patterns": [
        {
          "match": "(\\|)\\s*([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.operator.filter.django" },
            "2": { "name": "support.function.filter.django" }
          }
        }
      ]
    },
    "django-strings": {
      "patterns": [
        {
          "name": "string.quoted.double.django",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.django",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.single.django",
          "begin": "'",
          "end": "'",
          "patterns": [
            {
              "name": "constant.character.escape.django",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "django-numbers": {
      "patterns": [
        {
          "name": "constant.numeric.django",
          "match": "\\b\\d+(\\.\\d+)?\\b"
        }
      ]
    },
    "django-operators": {
      "patterns": [
        {
          "name": "keyword.operator.comparison.django",
          "match": "==|!=|<>|<=?|>=?"
        },
        {
          "name": "keyword.operator.assignment.django",
          "match": "="
        },
        {
          "name": "keyword.operator.arithmetic.django",
          "match": "\\+|-|\\*|/|%|\\*\\*|//"
        },
        {
          "name": "punctuation.separator.django",
          "match": "[:,]"
        }
      ]
    },
    "django-variables-inner": {
      "patterns": [
        {
          "name": "variable.other.django",
          "match": "[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "name": "punctuation.accessor.django",
          "match": "\\."
        }
      ]
    }
  }
}
